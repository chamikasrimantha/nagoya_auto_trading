<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Stock | Nagoya Auto Trading</title>
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/font-awesome.min.css" rel="stylesheet">
	<link href="css/global.css" rel="stylesheet">
	<link href="css/models.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
	<script src="js/bootstrap.bundle.min.js"></script>
	<style>
		.fixed-img {
			width: 100% !important;
			/* Ensures 100% width */
			height: 100% !important;
			/* Fixed height of 80px */
			object-fit: cover;
			/* Ensures the image covers the area without distortion */
		}
	</style>
	<script type="module">
		import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
		import {
			getFirestore,
			collection,
			getDocs,
			query,
			where,
			limit,
			startAfter,
			orderBy,
			doc,
			getDoc
		} from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";

		const firebaseConfig = {
			apiKey: "AIzaSyCXuKCcLMPIlRKE2HS36lVJG2kjBqnfREk",
			authDomain: "nagoya-auto.firebaseapp.com",
			projectId: "nagoya-auto",
			storageBucket: "nagoya-auto.firebasestorage.app",
			messagingSenderId: "718031210560",
			appId: "1:718031210560:web:fde1b59ada6102eca437a5",
			measurementId: "G-E2VNX8VFCZ"
		};

		const app = initializeApp(firebaseConfig);
		const db = getFirestore(app);

		let lastVisible = null;
		let currentPage = 1;
		let currentFilters = {};

		// Function to create car card HTML
		function createCarCard(car, carId) {
			return `
				<div class="col-md-4">
					<div class="model_pg1i clearfix">
						<div class="model_pg1i1">
							<div class="grid clearfix">
								<figure class="effect-jazz mb-0">
									<a href="#">
										<img src="${car.image1}" class="w-100 fixed-img" alt="${car.carName}">
									</a>
								</figure>
							</div>
						</div>
		
						<div class="model_m p-3 clearfix border-top-0">
							<div class="model_pg1i2 row">
								<div class="col-md-6 col-sm-6">
									<div class="model_pg1i2l">
										<h4>${car.carName}</h4>
									</div>
								</div>
								<div class="col-md-6 col-sm-6">
									<div class="model_pg1i2r text-end">
										<h3 class="mb-1"><i class="fa fa-dollar col_oran"></i> ${car.price}</h3>
										<h6 class="mb-0 font_14">Price</h6>
									</div>
								</div>
							</div>
							<div class="model_pg1i3 row mt-4 mb-4">
								<div class="col-md-6 col-sm-6">
									<div class="model_pg1i3l">
										<h6><i class="fa fa-car col_oran me-1"></i> ${car.transmission}</h6>
										<h6 class="mb-0 mt-3"><i class="fa fa-tint col_oran me-1"></i> ${car.fuelType}</h6>
									</div>
								</div>
								<div class="col-md-6 col-sm-6">
									<div class="model_pg1i3l text-end">
										<h6><i class="fa fa-user col_oran me-1"></i> ${car.steeringWheel} Hand</h6>
										<h6 class="mb-0 mt-3"><i class="fa fa-calendar col_oran me-1"></i> ${car.cc} CC</h6>
									</div>
								</div>
							</div>
							<hr>
							<div class="model_pg1i4 row text-center mt-4">
								<div class="col-md-12">
									<h6 class="mb-0">
										<a class="button view-btn" href="stock-details.html?stockId=${carId}">View <i class="fa fa-search ms-1"></i></a>
									</h6>
								</div>
							</div>
						</div>
					</div>
				</div>
			`;
		}

		// Function to get name from a specific collection
		async function getNameFromCollection(collectionName, docId) {
			if (!docId) return '';
			try {
				const docRef = doc(db, collectionName, docId);
				const docSnap = await getDoc(docRef);
				return docSnap.exists() ? docSnap.data().name : docId;
			} catch (error) {
				console.error(`Error fetching name from ${collectionName}:`, error);
				return docId;
			}
		}

		// Function to populate dropdown options
		async function populateDropdowns() {
			const carCollection = collection(db, "cars");
			const snapshot = await getDocs(carCollection);

			// Extract unique values for each filter
			const makes = new Map();
			const models = new Map();
			const colors = new Map();
			const years = new Set();
			const fuelTypes = new Set();
			const transmissions = new Set();
			const steeringWheels = new Set();

			// Collect all unique IDs first
			snapshot.forEach(doc => {
				const car = doc.data();
				makes.set(car.make, car.make);
				models.set(car.model, car.model);
				colors.set(car.color, car.color);
				years.add(car.year);
				fuelTypes.add(car.fuelType);
				transmissions.add(car.transmission);
				steeringWheels.add(car.steeringWheel);
			});

			// Populate dropdowns with names
			await Promise.all([
				populateDropdown('makeFilter', await Promise.all(
					Array.from(makes.keys()).map(async (id) => ({
						id: id,
						name: await getNameFromCollection('Make', id)
					}))
				)),
				populateDropdown('modelFilter', await Promise.all(
					Array.from(models.keys()).map(async (id) => ({
						id: id,
						name: await getNameFromCollection('Model', id)
					}))
				)),
				populateDropdown('colorFilter', await Promise.all(
					Array.from(colors.keys()).map(async (id) => ({
						id: id,
						name: await getNameFromCollection('Color', id)
					}))
				)),
				populateDropdown('yearFilter', await Promise.all(
					Array.from(years.keys()).map(async (id) => ({
						id: id,
						name: await getNameFromCollection('Year', id)
					}))
				)),
			]);

			// Populate other dropdowns
			populateDropdown('fuelTypeFilter', Array.from(fuelTypes).map(type => ({
				id: type,
				name: type
			})));
			populateDropdown('transmissionFilter', Array.from(transmissions).map(trans => ({
				id: trans,
				name: trans
			})));
			populateDropdown('steeringWheelFilter', Array.from(steeringWheels).map(wheel => ({
				id: wheel,
				name: wheel
			})));
		}

		function populateDropdown(elementId, options) {
			const select = document.getElementById(elementId);
			select.innerHTML = '<option value="">All</option>';
			options.forEach(option => {
				const optionElement = document.createElement('option');
				optionElement.value = option.id;
				optionElement.textContent = option.name;
				select.appendChild(optionElement);
			});
		}

		// Enhanced loadCars function with filtering
		async function loadCars() {
			const carContainer = document.getElementById("car-container");

			// Build query with filters
			let carQuery = collection(db, "cars");
			let constraints = [];

			// Check if any filters are applied
			const hasFilters = Object.values(currentFilters).some(value => value !== '');

			// Add constraints based on selected filters
			if (currentFilters.make) constraints.push(where("make", "==", currentFilters.make));
			if (currentFilters.model) constraints.push(where("model", "==", currentFilters.model));
			if (currentFilters.color) constraints.push(where("color", "==", currentFilters.color));
			if (currentFilters.year) constraints.push(where("year", "==", currentFilters.year));
			if (currentFilters.fuelType) constraints.push(where("fuelType", "==", currentFilters.fuelType));
			if (currentFilters.transmission) constraints.push(where("transmission", "==", currentFilters.transmission));
			if (currentFilters.steeringWheel) constraints.push(where("steeringWheel", "==", currentFilters.steeringWheel));

			// Price range filter
			if (currentFilters.minPrice || currentFilters.maxPrice) {
				if (currentFilters.minPrice && currentFilters.maxPrice) {
					constraints.push(
						where("price", ">=", parseFloat(currentFilters.minPrice)),
						where("price", "<=", parseFloat(currentFilters.maxPrice))
					);
				} else if (currentFilters.minPrice) {
					constraints.push(where("price", ">=", parseFloat(currentFilters.minPrice)));
				} else if (currentFilters.maxPrice) {
					constraints.push(where("price", "<=", parseFloat(currentFilters.maxPrice)));
				}
			}

			// Construct the query
			carQuery = hasFilters
				? query(collection(db, "cars"), ...constraints)
				: query(collection(db, "cars"), limit(12));

			const querySnapshot = await getDocs(carQuery);

			carContainer.innerHTML = ""; // Clear previous data

			if (querySnapshot.empty) {
				carContainer.innerHTML = '<div class="col-12 text-center"><p>No cars found matching the selected filters.</p></div>';
				return;
			}

			querySnapshot.forEach((doc) => {
				const car = doc.data();
				const carId = doc.id;

				carContainer.innerHTML += createCarCard(car, carId);
			});

			// If no filters applied, show pagination
			if (!hasFilters) {
				const paginationContainer = document.getElementById("pagination");
				paginationContainer.innerHTML = `
					<button class="btn btn-primary" onclick="navigatePage(-1)" ${currentPage <= 1 ? 'disabled' : ''}>Previous</button>
					<button class="btn btn-primary" onclick="navigatePage(1)">Next</button>
				`;
			} else {
				// Clear pagination if filters are applied
				const paginationContainer = document.getElementById("pagination");
				paginationContainer.innerHTML = '';
			}
		}

		// Function to apply filters
		function applyFilters() {
			// Collect filter values
			currentFilters = {
				make: document.getElementById('makeFilter').value,
				model: document.getElementById('modelFilter').value,
				color: document.getElementById('colorFilter').value,
				year: document.getElementById('yearFilter').value,
				minPrice: document.getElementById('minPriceFilter').value,
				maxPrice: document.getElementById('maxPriceFilter').value,
				fuelType: document.getElementById('fuelTypeFilter').value,
				transmission: document.getElementById('transmissionFilter').value,
				steeringWheel: document.getElementById('steeringWheelFilter').value
			};

			// Remove empty filter values
			Object.keys(currentFilters).forEach(key =>
				currentFilters[key] === '' && delete currentFilters[key]
			);

			// Reload cars with new filters
			loadCars();
		}

		// Function to reset filters
		function resetFilters() {
			// Reset all dropdowns and inputs
			document.getElementById('makeFilter').selectedIndex = 0;
			document.getElementById('modelFilter').selectedIndex = 0;
			document.getElementById('colorFilter').selectedIndex = 0;
			document.getElementById('yearFilter').selectedIndex = 0;
			document.getElementById('minPriceFilter').value = '';
			document.getElementById('maxPriceFilter').value = '';
			document.getElementById('fuelTypeFilter').selectedIndex = 0;
			document.getElementById('transmissionFilter').selectedIndex = 0;
			document.getElementById('steeringWheelFilter').selectedIndex = 0;

			// Clear filters
			currentFilters = {};

			// Reload cars
			loadCars();
		}

		// Pagination function
		function navigatePage(direction) {
			currentPage += direction;
			loadCars();
		}

		// Add event listeners
		document.addEventListener('DOMContentLoaded', () => {
			// Populate dropdowns
			populateDropdowns();

			// Add event listeners to filter inputs
			const filterInputs = document.querySelectorAll('#filterForm select, #filterForm input');
			filterInputs.forEach(input => {
				input.addEventListener('change', applyFilters);
			});

			// Reset button listener
			document.getElementById('resetFilters').addEventListener('click', resetFilters);

			// Initial load of cars
			loadCars();
		});

		// Expose navigatePage to global scope for onclick event
		window.navigatePage = navigatePage;
	</script>
	<style>
		#filterForm {
			background-color: #f8f9fa;
			padding: 20px;
			border-radius: 10px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
		}

		#filterForm .form-label {
			font-weight: 600;
			color: #333;
		}

		#filterForm .form-select,
		#filterForm .form-control {
			border-color: #ddd;
		}

		#resetFilters {
			background-color: #6c757d;
			color: white;
		}

		#resetFilters:hover {
			background-color: #545b62;
		}

		#pagination .btn {
			background-color: red;
			border: none;
			margin: 0 10px;
		}
	</style>
</head>

<body>

	<div class="main_o clearfix position-relative">
		<div class="main_1 clearfix position-absolute top-0 w-100">
			<section id="header">
				<nav class="navbar navbar-expand-md navbar-light" id="navbar_sticky">
					<div class="container-xl">
						<a class="navbar-brand fs-3 p-0 fw-bold text-white" href="index.html">
							<img src="img/logo.png" alt="Car Logo" class="me-1 fs-2 align-middle" style="height: 60px;">
							<!-- CAR <br> 
		<span class="fs-5 span_1">Lease</span> -->
						</a>
						<button class="navbar-toggler" type="button" data-bs-toggle="collapse"
							data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
							aria-expanded="false" aria-label="Toggle navigation">
							<span class="navbar-toggler-icon"></span>
						</button>
						<div class="collapse navbar-collapse" id="navbarSupportedContent">
							<ul class="navbar-nav mb-0 ">
								<li class="nav-item">
									<a class="nav-link" aria-current="page" href="index.html">Home</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="about.html">About </a>
								</li>
								<li class="nav-item">
									<a class="nav-link active" href="stock.html">Stock </a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="branches.html">Branches </a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="team.html">Team</a>
								</li>
								<!-- <li class="nav-item dropdown">
									<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
										data-bs-toggle="dropdown" aria-expanded="false">
										Pages
									</a>
									<ul class="dropdown-menu drop_1" aria-labelledby="navbarDropdown">
										<li><a class="dropdown-item" href="login.html"> Login</a></li>
										<li><a class="dropdown-item border-0" href="register.html"> Register</a></li>
									</ul>
								</li> -->
								<li class="nav-item">
									<a class="nav-link" href="contact.html">Contact</a>
								</li>
							</ul>
							<ul class="navbar-nav mb-0 ms-auto">
								<!-- <li class="nav-item">
									<a class="nav-link" href="login.html">Sign In</a>
								</li> -->
								<li class="nav-item">
									<a class="nav-link button_2 ms-2 me-2" href="register.html">Whatsapp <i
											class="fa fa-whatsapp ms-1"></i></a>
								</li>

							</ul>
						</div>
					</div>
				</nav>
			</section>
		</div>
		<div class="main_2 clearfix">
			<section id="center" class="center_o">
				<div class="center_om clearfix">
					<div class="container-xl">
						<div class="row center_o1">
							<div class="col-md-12">
								<h2 class="text-white">Stock</h2>
								<h6 class="mb-0 mt-3 fw-normal col_oran"><a class="text-light" href="#">Home</a> <span
										class="mx-2 col_light">/</span> Stock</h6>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>

	</div>

	<br /><br />

	<div class="container-fluid">
		<div class="row">
			<!-- Sidebar Filter Section -->
			<div class="col-md-3">
				<div class="sidebar-filter">
					<form id="filterForm" class="row g-3">
						<div class="col-12">
							<label for="makeFilter" class="form-label">Make</label>
							<select id="makeFilter" class="form-select">
								<option value="">All Makes</option>
							</select>
						</div>
						<div class="col-12">
							<label for="modelFilter" class="form-label">Model</label>
							<select id="modelFilter" class="form-select">
								<option value="">All Models</option>
							</select>
						</div>
						<div class="col-12">
							<label for="colorFilter" class="form-label">Color</label>
							<select id="colorFilter" class="form-select">
								<option value="">All Colors</option>
							</select>
						</div>
						<div class="col-12">
							<label for="yearFilter" class="form-label">Year</label>
							<select id="yearFilter" class="form-select">
								<option value="">All Years</option>
							</select>
						</div>
						<div class="col-12">
							<label for="fuelTypeFilter" class="form-label">Fuel Type</label>
							<select id="fuelTypeFilter" class="form-select">
								<option value="">All Fuel Types</option>
							</select>
						</div>
						<div class="col-12">
							<label for="transmissionFilter" class="form-label">Transmission</label>
							<select id="transmissionFilter" class="form-select">
								<option value="">All Transmissions</option>
							</select>
						</div>
						<div class="col-12">
							<label for="steeringWheelFilter" class="form-label">Steering Wheel</label>
							<select id="steeringWheelFilter" class="form-select">
								<option value="">All</option>
							</select>
						</div>
						<div class="col-12">
							<label for="minPriceFilter" class="form-label">Min Price</label>
							<input type="number" id="minPriceFilter" class="form-control" placeholder="Min Price">
						</div>
						<div class="col-12">
							<label for="maxPriceFilter" class="form-label">Max Price</label>
							<input type="number" id="maxPriceFilter" class="form-control" placeholder="Max Price">
						</div>
						<div class="col-12">
							<button type="button" id="resetFilters" class="btn btn-secondary w-100">Reset Filters</button>
						</div>
					</form>
				</div>
			</div>
			
			<!-- Car Listings Section -->
			<div class="col-md-9">
				<section id="model_pg" class="p_3">
					<div class="row model_pg1" id="car-container">
						<!-- Cars will be loaded here dynamically -->
					</div>
				</section>

				<!-- Pagination container -->
				<div id="pagination" class="text-center my-3"></div>
			</div>
		</div>
	</div>

	<style>
		.fixed-img {
			width: 90% !important;
			height: 250px !important;
			object-fit: cover;
		}
		.sidebar-filter {
			background-color: #f8f9fa;
			padding: 20px;
			border-radius: 10px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			max-height: 100vh;
			overflow-y: auto;
		}
		#filterForm {
			background-color: transparent !important;
			padding: 0 !important;
			box-shadow: none !important;
		}
		.car-listings {
			background-color: white;
			border-radius: 10px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			padding: 20px;
		}
	</style>

	<section id="model_pg" class="p_3">
		<div class="container-xl">
			
		</div>
	</section>

	<section id="ride">
		<div class="ride_m">
			<div class="container-xl">
				<div class="row ride_1">
					<div class="col-md-8">
						<div class="ride_1l">
							<h1 class="text-white">Save big with Nagoya Auto Trading’s <br> affordable car buying options!</h1>
							<p class="text-light mb-0 fs-4 mt-3">Top Dealerships. Trusted Local Suppliers. 24/7 Customer Support.</p>
						</div>
					</div>
					<div class="col-md-4">
						<div class="ride_1r mt-4 text-end">
							<h6 class="mb-0"><a class="button_2" href="#">Buy a Car <i
										class="fa fa-check-circle ms-1"></i> </a></h6>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section id="footer" class="pt-3 pb-3">
		<div class="container-xl">
			<div class="row footer_1">
				<div class="col-md-4">
					<div class="footer_1i">
						<h4> Nagoya Auto Trading</h4>
						<p class="mt-3">At Nagoya Auto Trading, we focus on providing top-quality services and products
							to meet your
							automotive needs.
						</p>
						<h6 class="mt-3 fw-normal"><i class="fa fa-map col_oran me-1"></i> Nagoya, Japan</h6>
						<h6 class="mt-3 fw-normal"><a href="#"><i class="fa fa-phone col_oran me-1"></i> +(94) 76 184
								4962</a></h6>
						<h6 class="mt-3 mb-0 fw-normal"><a href="#"><i class="fa fa-envelope col_oran me-1"></i>
								info@nagoya-auto-trading.com</a>
						</h6>
					</div>
				</div>
				<div class="col-md-2">
					<div class="footer_1i">
						<h4>COMPANY</h4>
						<div class="row">
							<h6 class="fw-normal mt-2 col-md-12 col-6"><a href="index.html">Nagoya</a></h6>
							<h6 class="fw-normal mt-2 col-md-12 col-6"><a href="about.html">About Us</a></h6>
							<h6 class="fw-normal mt-2 col-md-12 col-6"><a href="blog.html">Branches</a></h6>
							<h6 class="fw-normal mt-2 col-md-12 col-6"><a href="models.html">Stock</a></h6>
							<h6 class="fw-normal mt-2 col-md-12 col-6"><a href="team.html">Team</a></h6>
							<h6 class="fw-normal mt-2 mb-0 col-md-12 col-6"><a href="contact.html">Contact Us</a></h6>
						</div>
					</div>
				</div>
				<div class="col-md-3">
					<div class="footer_1i">
						<h4>WORK HOURS</h4>
						<p class="mt-3">Mon - Fri: <span class="fw-bold text-black">08:00AM - 05:00PM</span></p>
						<p class="mt-3">Sat: <span class="fw-bold text-black">08:00AM - 12:00PM</span></p>
						<p class="mt-3 mb-0">Sun: <span class="fw-bold text-black">Closed</span></p>
					</div>
				</div>
				<div class="col-md-3">
					<div class="footer_1i">
						<h4>SUBSCRIPTION</h4>
						<p class="mt-3">Subscribe your Email address for latest news & updates.</p>
						<input class="form-control" placeholder="Enter Email Address" type="text">
						<h6 class="mb-0 mt-4"><a class="button pt-3 pb-3" href="#">Submit <i
									class="fa fa-check-circle ms-1"></i>
							</a></h6>
					</div>
				</div>
			</div>
			<hr>
			<div class="row footer_2">
				<div class="col-md-8">
					<div class="footer_2l">
						<p class="mb-0 mt-1">© 2025 Nagoya Auto Trading. All Rights Reserved | Designed & Developed by
							<a class="col_green" href="https://www.easycat.live/">EasyCat Technologies</a>
						</p>
					</div>
				</div>
				<div class="col-md-4">
					<div class="footer_2r text-end">
						<ul class="social-network social-circle mb-0">
							<li><a href="#" class="icoRss" title="Rss"><i class="fa fa-facebook"></i></a></li>
							<li><a href="#" class="icoFacebook" title="Facebook"><i class="fa fa-instagram"></i></a>
							</li>
							<li><a href="#" class="icoTwitter" title="Twitter"><i class="fa fa-whatsapp"></i></a></li>
							<li><a href="#" class="icoLinkedin" title="Linkedin"><i class="fa fa-linkedin"></i></a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</section>

	<script>
		window.onscroll = function () { myFunction() };

		var navbar_sticky = document.getElementById("navbar_sticky");
		var sticky = navbar_sticky.offsetTop;
		var navbar_height = document.querySelector('.navbar').offsetHeight;

		function myFunction() {
			if (window.pageYOffset >= sticky + navbar_height) {
				navbar_sticky.classList.add("sticky")
				document.body.style.paddingTop = navbar_height + 'px';
			} else {
				navbar_sticky.classList.remove("sticky");
				document.body.style.paddingTop = '0'
			}
		}
	</script>

</body>

</html>